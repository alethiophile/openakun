{% macro edit_icon(size) -%}
    <svg width="{{ size }}" height="{{ size }}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M21.2799 6.40005L11.7399 15.94C10.7899 16.89 7.96987 17.33 7.33987 16.7C6.70987 16.07 7.13987 13.25 8.08987 12.3L17.6399 2.75002C17.8754 2.49308 18.1605 2.28654 18.4781 2.14284C18.7956 1.99914 19.139 1.92124 19.4875 1.9139C19.8359 1.90657 20.1823 1.96991 20.5056 2.10012C20.8289 2.23033 21.1225 2.42473 21.3686 2.67153C21.6147 2.91833 21.8083 3.21243 21.9376 3.53609C22.0669 3.85976 22.1294 4.20626 22.1211 4.55471C22.1128 4.90316 22.0339 5.24635 21.8894 5.5635C21.7448 5.88065 21.5375 6.16524 21.2799 6.40005V6.40005Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M11 4H6C4.93913 4 3.92178 4.42142 3.17163 5.17157C2.42149 5.92172 2 6.93913 2 8V18C2 19.0609 2.42149 20.0783 3.17163 20.8284C3.92178 21.5786 4.93913 22 6 22H17C19.21 22 20 20.2 20 18V13" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
{%- endmacro -%}
{%- macro dropdown_icon(size) -%}
    <svg width="{{ size }}" height="{{ size }}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12.7071 14.7071C12.3166 15.0976 11.6834 15.0976 11.2929 14.7071L6.29289 9.70711C5.90237 9.31658 5.90237 8.68342 6.29289 8.29289C6.68342 7.90237 7.31658 7.90237 7.70711 8.29289L12 12.5858L16.2929 8.29289C16.6834 7.90237 17.3166 7.90237 17.7071 8.29289C18.0976 8.68342 18.0976 9.31658 17.7071 9.70711L12.7071 14.7071Z" fill="#000000"></path> </g></svg>
{%- endmacro -%}
{%- macro chat_page_list(page_list_data, channel_id, htmx_oob) -%}
{% if page_list_data.pages %}
<div id="chat_topctrl" {% if htmx_oob %}hx-swap-oob="true"{% endif %} class="text-center p-2">
    {% set current = page_list_data.current_page %}
    {% set total_pages = page_list_data.pages | length %}
    
    <!-- All pages rendered, with visibility controlled by CSS classes -->
    {% for page in page_list_data.pages %}
        {% set page_idx = loop.index0 %}
        {% set is_current = page_idx == current %}
        {% set in_range = page_idx >= (current - 5) and page_idx <= (current + 5) %}
        {% set is_first = page_idx == 0 %}
        {% set is_last = page_idx == (total_pages - 1) %}
        {% set show_in_truncated = in_range or (is_first and current > 5) or (is_last and current < total_pages - 6) %}
        
        {% if is_current %}
            <span class="px-2 py-1 bg-blue-500 text-white rounded{% if not show_in_truncated %} page-hidden hidden{% endif %}">{{ page.page_num + 1 }}</span>
        {% else %}
            <a href="#" 
               hx-get="{{ url_for('questing.view_chat', channel_id=channel_id, after_date=page.date_iso) }}"
               hx-target="#chat-messages" hx-swap="outerHTML"
               class="px-2 py-1 text-blue-600 hover:bg-blue-100 rounded cursor-pointer{% if not show_in_truncated %} page-hidden hidden{% endif %}">{{ page.page_num + 1 }}</a>
        {% endif %}
        
        <!-- Add ellipsis after first page if needed -->
        {% if page_idx == 0 and current > 6 and total_pages > 11 %}
            <span class="px-1 ellipsis-start">...</span>
        {% endif %}
        
        <!-- Add ellipsis before last page if needed -->
        {% if page_idx == (total_pages - 2) and current < total_pages - 7 and total_pages > 11 %}
            <span class="px-1 ellipsis-end">...</span>
        {% endif %}
    {% endfor %}
    
    {% if total_pages > 11 %}
    <button hx-on:click="
        const hidden = document.querySelectorAll('.page-hidden');
        const ellipsisStart = document.querySelector('.ellipsis-start');
        const ellipsisEnd = document.querySelector('.ellipsis-end');
        const isHidden = hidden[0] && hidden[0].classList.contains('hidden');
        
        hidden.forEach(el => el.classList.toggle('hidden'));
        if (ellipsisStart) ellipsisStart.classList.toggle('hidden');
        if (ellipsisEnd) ellipsisEnd.classList.toggle('hidden');
        
        this.textContent = isHidden ? 'Show Less' : 'Show All';
    " class="ml-2 px-2 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded cursor-pointer">Show All</button>
    {% endif %}
</div>
{% endif %}
{%- endmacro -%}
